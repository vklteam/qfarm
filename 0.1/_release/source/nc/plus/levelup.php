<?php

# 升级提示

$levelups = array(
	"200" => array("eDesc" => "两颗玉米种子", "eType" => "1", "eParam" => "4", "eNum" => "2", "name" => "玉米", "level" => 1),
	"600" => array("eDesc" => "两包普通化肥", "eType" => "3", "eParam" => "1", "eNum" => "2", "name" => "普通化肥", "level" => 2),
	"1200" => array("eDesc" => "两颗茄子种子", "eType" => "1", "eParam" => "6", "eNum" => "2", "name" => "茄子", "level" => 3),
	"2000" => array("eDesc" => "两颗番茄种子", "eType" => "1", "eParam" => "7", "eNum" => "2", "name" => "番茄", "level" => 4),
	"3000" => array("eDesc" => "两包高速化肥", "eType" => "3", "eParam" => "2", "eNum" => "2", "name" => "高速化肥", "level" => 5),
	"4200" => array("eDesc" => "两颗辣椒种子", "eType" => "1", "eParam" => "9", "eNum" => "2", "name" => "辣椒", "level" => 6),
	"5600" => array("eDesc" => "两颗南瓜种子", "eType" => "1", "eParam" => "10", "eNum" => "2", "name" => "魔鬼南瓜", "level" => 7),
	"7200" => array("eDesc" => "两颗苹果种子", "eType" => "1", "eParam" => "11", "eNum" => "2", "name" => "苹果", "level" => 8),
	"9000" => array("eDesc" => "两颗草莓种子", "eType" => "1", "eParam" => "1", "eNum" => "2", "name" => "草莓", "level" => 9),
	"11000" => array("eDesc" => "两包极速化肥", "eType" => "3", "eParam" => "3", "eNum" => "2", "name" => "极速化肥", "level" => 10),
	"13200" => array("eDesc" => "两颗香蕉种子", "eType" => "1", "eParam" => "15", "eNum" => "2", "name" => "香蕉", "level" => 11),
	"15600" => array("eDesc" => "两颗桃子种子", "eType" => "1", "eParam" => "18", "eNum" => "2", "name" => "桃子", "level" => 12),
	"18200" => array("eDesc" => "两颗橙子种子", "eType" => "1", "eParam" => "19", "eNum" => "2", "name" => "橙子", "level" => 13),
	"21000" => array("eDesc" => "两颗葡萄种子", "eType" => "1", "eParam" => "13", "eNum" => "2", "name" => "葡萄", "level" => 14),
	"24000" => array("eDesc" => "三包极速化肥", "eType" => "3", "eParam" => "3", "eNum" => "3", "name" => "极速化肥", "level" => 15),
	"27200" => array("eDesc" => "两颗柚子种子", "eType" => "1", "eParam" => "26", "eNum" => "2", "name" => "柚子", "level" => 16),
	"30600" => array("eDesc" => "两颗菠萝种子", "eType" => "1", "eParam" => "27", "eNum" => "2", "name" => "菠萝", "level" => 17),
	"34200" => array("eDesc" => "五包极速化肥", "eType" => "3", "eParam" => "3", "eNum" => "5", "name" => "极速化肥", "level" => 18),
	"38000" => array("eDesc" => "两颗葫芦种子", "eType" => "1", "eParam" => "31", "eNum" => "2", "name" => "葫芦", "level" => 19),
	//type为装饰的类型...
	"42000" => array("eDesc" => "一套董衣草之恋背景", "eType" => "2", "eParam" => "253", "eNum" => "1", "type"=>"1", "name" => "董衣草之恋背景", "level" => 20),
	"46200" => array("eDesc" => "一套董衣草之恋红栏", "eType" => "2", "eParam" => "255", "eNum" => "1", "type"=>"3", "name" => "董衣草之恋红栏", "level" => 21),
	"50600" => array("eDesc" => "一套董衣草之恋狗窝", "eType" => "2", "eParam" => "256", "eNum" => "1", "type"=>"4", "name" => "董衣草之恋狗窝", "level" => 22),
	"55200" => array("eDesc" => "一套董衣草之恋大屋", "eType" => "2", "eParam" => "254", "eNum" => "1", "type"=>"2", "name" => "董衣草之恋大屋", "level" => 23),
	"60000" => array("eDesc" => "十包极速化肥", "eType" => "3", "eParam" => "3", "eNum" => "10", "name" => "极速化肥", "level" => 24),
	"65000" => array("eDesc" => "两颗柠檬种子", "eType" => "1", "eParam" => "42", "eNum" => "2", "name" => "柠檬", "level" => 25),
	"70200" => array("eDesc" => "两颗枇杷种子", "eType" => "1", "eParam" => "55", "eNum" => "2", "name" => "枇杷", "level" => 26),
	"75600" => array("eDesc" => "两颗甘蔗种子", "eType" => "1", "eParam" => "47", "eNum" => "2", "name" => "甘蔗", "level" => 27),
	"81200" => array("eDesc" => "两颗蘑菇种子", "eType" => "1", "eParam" => "50", "eNum" => "2", "name" => "蘑菇", "level" => 28),
	"87000" => array("eDesc" => "两颗杨梅种子", "eType" => "1", "eParam" => "48", "eNum" => "2", "name" => "杨梅", "level" => 29),
	"93000" => array("eDesc" => "两颗月柿种子", "eType" => "1", "eParam" => "80", "eNum" => "2", "name" => "月柿", "level" => 30)
);


$levelup_exp = $levelup; //include之前必须的查询出来levelup值
$vip1 = $_QFG['db']->result("SELECT vip FROM app_qqfarm_user where uid=" . $_QFG['uid']);
$vip1 = qf_decode($vip1);
$listup = $_QFG['db']->fetchOne("SELECT package,tools,decorative FROM app_qqfarm_nc where uid=" . $_QFG['uid']);
$package = qf_decode($listup['package']);
$fertilizer = qf_decode($listup['tools']);
$decorative = qf_decode($listup['decorative']);
//读VIP级别，根据VIP级别送不同的

//提示信息
if((int)$vip1['valid'] > $_QFG['timestamp']) {
	$vipquantity = 2;
	$levelup_arr = '{"title":"升级奖励","direction":"这么快就升级到' . $levelups[$levelup_exp]['level'] . '级了啊？真是神速，奖励你' . $levelups[$levelup_exp]['eDesc'] . '，快到背包里看看吧。","item":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"level":' . $levelups[$levelup_exp]['level'] . ',"vipItem":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"vipText":"你是VIP用户，还可额外再获赠以下奖励："}';	
} else{
	$vipquantity = 1;
	$levelup_arr = '{"title":"升级奖励","direction":"这么快就升级到' . $levelups[$levelup_exp]['level'] . '级了啊？真是神速，奖励你' . $levelups[$levelup_exp]['eDesc'] . '，快到背包里看看吧。","item":[{"eType":"' . $levelups[$levelup_exp]['eType'] . '","eParam":"' . $levelups[$levelup_exp]['eParam'] . '","eNum":"' . $levelups[$levelup_exp]['eNum'] . '"}],"level":' . $levelups[$levelup_exp]['level'] . '}';
}

//更新数据库
$levelup_sql = "";
if(1 == $levelups[$levelup]['eType']) {
	$zhongzi = $levelups[$levelup_exp]['eParam'];
	$package[$zhongzi] = $package[$zhongzi] + $levelups[$levelup_exp]['eNum'] * $vipquantity;
	$levelup_sql = ",package='".qf_encode($package)."'";//种子
} elseif(2 == $levelups[$levelup_exp]['eType']) {
	$decType = $levelups[$levelup_exp]['type']; //类型
	$decID = $levelups[$levelup_exp]['eParam']; //装饰ID
	foreach((array)$decorative as $item_type => $value) {
		foreach((array)$value as $key1 => $value1) {
			if($key1 == $decID) {
				$buyed = 1;
				$decorative[$decType][$decID]['validtime'] += $itemtype[$decID]['itemValidTime'] * $vipquantity;
			}
		}
	}
	if(!$buyed) {
		$decorative[$decType][$decID]['status'] = 0;
		$decorative[$decType][$decID]['validtime'] = $_QFG['timestamp'] + $itemtype[$decID]['itemValidTime'] * $vipquantity;
	}
	$levelup_sql = ",decorative='".qf_encode($decorative)."'";//装饰
} elseif(3 == $levelups[$levelup_exp]['eType']) {
	$gongju = $levelups[$levelup_exp]['eParam'];
	$fertilizer[$gongju] = $fertilizer[$gongju] + $levelups[$levelup_exp]['eNum'] * $vipquantity;
	$levelup_sql = ",tools='".qf_encode($fertilizer)."'";//道具
}

$nextExp = qf_toExp(qf_toLevel($levelup_exp) + 1); //下一级别的经验值
$_QFG['db']->query("UPDATE app_qqfarm_nc set levelup={$nextExp}{$levelup_sql} where uid=". $_QFG['uid']);

?>